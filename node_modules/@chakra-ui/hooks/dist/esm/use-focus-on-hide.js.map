{"version":3,"sources":["../../src/use-focus-on-hide.ts"],"names":["focus","isFocusable","useRef","useEventListener","useUpdateEffect","useFocusOnHide","popoverRef","options","isFocusableRef","focusRef","shouldFocus","visible","autoFocus","onPointerDown","event","target","prevent","current","contains"],"mappings":"AAAA,SAASA,KAAT,EAAkCC,WAAlC,QAAqD,kBAArD;AACA,SAAoBC,MAApB,QAAkC,OAAlC;AACA,SAASC,gBAAT,QAAiC,sBAAjC;AACA,SAASC,eAAT,QAAgC,qBAAhC;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,cAAT,CACLC,UADK,EAELC,OAFK,EAGL;AACA,MAAMC,cAAc,GAAGN,MAAM,CAAC,KAAD,CAA7B;AACA,MAAM;AAAEO,IAAAA,QAAF;AAAYC,IAAAA,WAAZ;AAAyBC,IAAAA;AAAzB,MAAqCJ,OAA3C;AAEA,MAAMK,SAAS,GAAGF,WAAW,IAAI,CAACC,OAAlC;;AAEA,MAAME,aAAa,GAAIC,KAAD,IAAoC;AACxD,QAAI,CAACP,OAAO,CAACI,OAAb,EAAsB;AACtB,QAAMI,MAAM,GAAGD,KAAK,CAACC,MAArB;AAEA,QAAMC,OAAO,GACXf,WAAW,CAACc,MAAD,CAAX,IACAA,MAAM,KAAKN,QAAQ,CAACQ,OADpB,IAEA,CAAEX,UAAU,CAACW,OAAZ,CAAoCC,QAApC,CAA6CH,MAA7C,CAHH;;AAKA,QAAIC,OAAJ,EAAa;AACXR,MAAAA,cAAc,CAACS,OAAf,GAAyB,IAAzB;AACD;AACF,GAZD;;AAcAd,EAAAA,gBAAgB,CAAC,WAAD,EAAcU,aAAd,CAAhB;AACAV,EAAAA,gBAAgB,CAAC,YAAD,EAAeU,aAAf,CAAhB;AAEAT,EAAAA,eAAe,CAAC,MAAM;AACpB,WAAO,MAAM;AACX,UAAI,CAACO,OAAL,EAAc;AACZH,QAAAA,cAAc,CAACS,OAAf,GAAyB,KAAzB;AACD;AACF,KAJD;AAKD,GANc,EAMZ,CAACN,OAAD,CANY,CAAf;AAQAR,EAAAA,gBAAgB,CACd,eADc,EAEd,MAAM;AACJ,QAAI,CAACQ,OAAD,IAAYF,QAAQ,CAACQ,OAArB,IAAgC,CAACT,cAAc,CAACS,OAApD,EAA6D;AAC3DjB,MAAAA,KAAK,CAACS,QAAQ,CAACQ,OAAV,CAAL;AACD;AACF,GANa,EAOdX,UAAU,CAACW,OAPG,CAAhB;AAUA;AACF;AACA;AACA;;AACEb,EAAAA,eAAe,CAAC,MAAM;AACpB,QAAI,CAACQ,SAAD,IAAc,CAACN,UAAU,CAACW,OAA1B,IAAqCT,cAAc,CAACS,OAAxD,EAAiE;;AACjE,QAAIR,QAAQ,CAACQ,OAAb,EAAsB;AACpBjB,MAAAA,KAAK,CAACS,QAAQ,CAACQ,OAAV,CAAL;AACD;AACF,GALc,EAKZ,CAACL,SAAD,EAAYH,QAAZ,EAAsBE,OAAtB,EAA+BL,UAA/B,CALY,CAAf;AAMD","sourcesContent":["import { focus, FocusableElement, isFocusable } from \"@chakra-ui/utils\"\nimport { RefObject, useRef } from \"react\"\nimport { useEventListener } from \"./use-event-listener\"\nimport { useUpdateEffect } from \"./use-update-effect\"\n\nexport interface UseFocusOnHideOptions {\n  focusRef: RefObject<FocusableElement>\n  shouldFocus?: boolean\n  visible?: boolean\n}\n\n/**\n * Popover hook to manage the focus when the popover closes or hides.\n *\n * We either want to return focus back to the popover trigger or\n * let focus proceed normally if user moved to another interactive\n * element in the viewport.\n */\nexport function useFocusOnHide(\n  popoverRef: RefObject<HTMLElement>,\n  options: UseFocusOnHideOptions,\n) {\n  const isFocusableRef = useRef(false)\n  const { focusRef, shouldFocus, visible } = options\n\n  const autoFocus = shouldFocus && !visible\n\n  const onPointerDown = (event: MouseEvent | TouchEvent) => {\n    if (!options.visible) return\n    const target = event.target as HTMLElement\n\n    const prevent =\n      isFocusable(target) &&\n      target !== focusRef.current &&\n      !(popoverRef.current as HTMLElement).contains(target)\n\n    if (prevent) {\n      isFocusableRef.current = true\n    }\n  }\n\n  useEventListener(\"mousedown\", onPointerDown)\n  useEventListener(\"touchstart\", onPointerDown)\n\n  useUpdateEffect(() => {\n    return () => {\n      if (!visible) {\n        isFocusableRef.current = false\n      }\n    }\n  }, [visible])\n\n  useEventListener(\n    \"transitionend\",\n    () => {\n      if (!visible && focusRef.current && !isFocusableRef.current) {\n        focus(focusRef.current)\n      }\n    },\n    popoverRef.current,\n  )\n\n  /**\n   * Using updateEffect here to allow effect to run only when\n   * `options.visible` changes, not on mount\n   */\n  useUpdateEffect(() => {\n    if (!autoFocus || !popoverRef.current || isFocusableRef.current) return\n    if (focusRef.current) {\n      focus(focusRef.current)\n    }\n  }, [autoFocus, focusRef, visible, popoverRef])\n}\n"],"file":"use-focus-on-hide.js"}